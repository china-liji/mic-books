set state , 事件， ajax ，异步连续 setstate，会立即触发更新

```tsx
import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';
import { useStyles } from './useStyles';
import { Props } from './types';
import { DataLoader } from '../DataLoader';
import { Data } from '@/utils/data';
import { List } from './list';
import { shouldLoadMoreItems } from './methods';
import { $t } from '@/utils/locale';

export function InfinityLoader<DataType>({ className = '', pageSize, onRequest, onScroll, onRenderItem, ...props }: Props<DataType>): React.ReactElement {
  const ref = useRef<HTMLDivElement>();
  const { infinityLoader } = useStyles();
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);

  const [loader, setLoader] = useState(
    Data.null<Promise<DataType[]>>()
  );

  console.log(page, "update component")

  const onDivScroll = useCallback((): void => {
    // if should not load more items
    if (!shouldLoadMoreItems(loader, hasMore, ref.current as HTMLDivElement)) {
      return;
    }

    console.log(page, "to request")

    setLoader(
      onRequest(page, pageSize)
        .then((items: DataType[]): DataType[] => {
          // if items length is less than pageSize represents all items has been loaded
          if (items.length < pageSize) {
            setHasMore(false);
          }

          console.log(page + 1, "set page")
          // set the next page number
          setPage(page + 1);

          console.log(page + 1, "set loader")

          // clear the loader
          setLoader(
            Data.null<Promise<DataType[]>>()
          );

          console.log(page + 1, "set loader end")
          return items;
        })
    );

    console.log(page, " request end")
  }, [page, pageSize, loader, hasMore]);

  useEffect((): void => {
    console.log(page, "tigger scroll");
    // trigger event for the first data loading
    (ref.current as HTMLDivElement).dispatchEvent(
      new UIEvent('scroll')
    );
  }, [page]);

  console.log(page, 'update end')

  return (
    <div
      ref={ref as React.Ref<HTMLDivElement>}
      className={`${infinityLoader} ${className}`}
      onScroll={onDivScroll}
      {...props}
    >
      <DataLoader<DataType> loader={loader} dataKey='items' dataList>
        <List<DataType> onRenderItem={onRenderItem} />
      </DataLoader>
      {
        hasMore ?
          null :
          <p data-nomore>{$t('gin.dex.data.no.more')}</p>
      }
    </div>
  );
}
```

```txt
"set page"
index.tsx:20 2 "update component"
index.tsx:66 2 "update end"
index.tsx:42 2 "set loader"
index.tsx:59 2 "tigger scroll"
index.tsx:20 2 "update component"
index.tsx:66 2 "update end"
index.tsx:50 2 "set loader end"
```